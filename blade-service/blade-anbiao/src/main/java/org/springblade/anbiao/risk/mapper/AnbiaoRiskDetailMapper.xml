<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.springblade.anbiao.risk.mapper.AnbiaoRiskDetailMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="org.springblade.anbiao.risk.entity.AnbiaoRiskDetail">
        <id column="ard_ids" property="ardIds" />
        <result column="ard_dept_ids" property="ardDeptIds" />
        <result column="ard_major_categories" property="ardMajorCategories" />
        <result column="ard_sub_category" property="ardSubCategory" />
        <result column="ard_title" property="ardTitle" />
        <result column="ard_content" property="ardContent" />
        <result column="ard_type" property="ardType" />
        <result column="ard_discovery_date" property="ardDiscoveryDate" />
        <result column="ard_is_rectification" property="ardIsRectification" />
        <result column="ard_association_table" property="ardAssociationTable" />
        <result column="ard_association_field" property="ardAssociationField" />
        <result column="ard_association_value" property="ardAssociationValue" />
        <result column="ard_rectification_by_ids" property="ardRectificationByIds" />
        <result column="ard_rectification_by_name" property="ardRectificationByName" />
        <result column="ard_rectification_date" property="ardRectificationDate" />
        <result column="ard_modular_name" property="ardModularName" />
        <result column="ard_rectification_field" property="ardRectificationField" />
        <result column="ard_rectification_value" property="ardRectificationValue" />
        <result column="ard_rectification_field_type" property="ardRectificationFieldType" />
        <result column="ard_rectification_enclosure" property="ardRectificationEnclosure" />
    </resultMap>

    <resultMap id="AnbiaoRiskDetailCountVOResultMap" type="org.springblade.anbiao.risk.vo.AnbiaoRiskDetailCountVO">
        <result column="ard_major_categories" property="ardMajorCategories" />
        <result column="ard_sub_category" property="ardSubCategory" />
        <result column="ard_discovery_date" property="ardDiscoveryDate" />
    </resultMap>

    <resultMap id="AnbiaoRiskDetailVOResultMap" type="org.springblade.anbiao.risk.vo.AnbiaoRiskDetailVO">
        <id column="ard_ids" property="ardIds" />
        <result column="ard_dept_ids" property="ardDeptIds" />
        <result column="ard_major_categories" property="ardMajorCategories" />
        <result column="ard_sub_category" property="ardSubCategory" />
        <result column="ard_title" property="ardTitle" />
        <result column="ard_content" property="ardContent" />
        <result column="ard_discovery_date" property="ardDiscoveryDate" />
        <result column="ard_association_table" property="ardAssociationTable" />
        <result column="ard_association_field" property="ardAssociationField" />
        <result column="ard_association_value" property="ardAssociationValue" />
    </resultMap>

    <resultMap id="JiaShiYuanResultMap" type="org.springblade.anbiao.jiashiyuan.entity.JiaShiYuan">
    </resultMap>

    <resultMap id="OrganizationsResultMap" type="org.springblade.anbiao.guanlijigouherenyuan.entity.Organizations">
    </resultMap>

    <resultMap id="VehicleResultMap" type="org.springblade.anbiao.cheliangguanli.entity.Vehicle">
    </resultMap>

    <select id="selectByCount" resultMap="AnbiaoRiskDetailCountVOResultMap">
        select
            ard_major_categories,
            ard_sub_category,
            count(1) as num
        from
            anbiao_risk_detail a
            inner join (
                <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
            ) b on a.ard_dept_ids = b.id
        where 1 = 1
<!--            ard_dept_ids = #{deptId}-->
            and left(ard_discovery_date,7) = left(#{date},7)
            and ard_is_rectification = 0
        GROUP BY
            ard_major_categories,
            ard_sub_category
    </select>

    <select id="selectByDateCount" resultMap="AnbiaoRiskDetailCountVOResultMap">
        select
            ard_major_categories,
            ard_sub_category,
            ard_discovery_date,
            count(1) as num
        from
            anbiao_risk_detail a
            inner join (
                <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
            ) b on a.ard_dept_ids = b.id
        where 1 = 1
        <!--ard_dept_ids = #{deptId}-->
            and left(ard_discovery_date,7) = left(#{date},7)
            and ard_is_rectification = 0
        GROUP BY
            ard_major_categories,
            ard_sub_category,
            ard_discovery_date
    </select>

    <select id="selectByCategoryCount" resultMap="AnbiaoRiskDetailVOResultMap">
        select
            ard_title,
            ard_type,
            ard_sub_category,
            ard_content,
            count(1) as num
        from
            anbiao_risk_detail a
            inner join (
                <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
            ) b on a.ard_dept_ids = b.id
        where 1 = 1
<!--        ard_dept_ids = #{deptId}-->
            and left(ard_discovery_date,7) = left(#{date},7)
            and ard_sub_category = #{category}
            and ard_is_rectification = 0
        GROUP BY
            ard_title,
            ard_type,
            ard_content
    </select>

    <select id="selectByCategoryMXCount" resultMap="AnbiaoRiskDetailVOResultMap">
        select
            ard_dept_ids,
            ard_ids,
            ard_title,
            ard_type,
            ard_discovery_date,
            ard_content,
            ard_association_value,
            ard_association_table,
            ard_association_field
        from
            anbiao_risk_detail a
            inner join (
                <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
            ) b on a.ard_dept_ids = b.id
        where 1 = 1
<!--            ard_dept_ids = #{deptId}-->
            and left(ard_discovery_date,7) = left(#{date},7)
            and ard_sub_category = #{category}
            and ard_is_rectification = 0
            and ard_content = #{ardContent}
    </select>

    <select id="selectMapList" resultMap="JiaShiYuanResultMap">
        select * from ${ardAssociationTable} where ${ardAssociationField} = #{ardAssociationValue}
    </select>

    <select id="selectOrganizationsMapList" resultMap="OrganizationsResultMap">
        select * from ${ardAssociationTable} where ${ardAssociationField} = #{ardAssociationValue}
    </select>

    <select id="selectVehicleMapList" resultMap="VehicleResultMap">
        select * from ${ardAssociationTable} where ${ardAssociationField} = #{ardAssociationValue}
    </select>

    <sql id="tableTJMXSql">
        select
            ard_dept_ids,
            ard_ids,
            ard_title,
            ard_type,
            ard_discovery_date,
            ard_content,
            ard_association_value,
            ard_association_table,
            ard_association_field
        from
            anbiao_risk_detail a
        inner join (
            <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
        ) b on a.ard_dept_ids = b.id
        where 1 = 1
        <!--            ard_dept_ids = #{deptId}-->
            and left(ard_discovery_date,7) = left(#{date},7)
            and ard_sub_category = #{category}
            and ard_is_rectification = 0
        <if test="ardContent !=null and ardContent != ''">
            and ard_content = #{ardContent}
        </if>
    </sql>
    <sql id="queryTJMXSql">

    </sql>
    <sql id="orderTJMXSql">
        <!-- 默认排序规则 -->
        <if test="orderColumn == null or orderColumn == ''">
            order by ard_ids desc
        </if>
        <if test="orderColumn != null and orderColumn != ''">
            order by ${orderColumn}
        </if>
        <if test="orderColumn != null and orderColumn != '' and order != 0">
            desc
        </if>
    </sql>

    <select timeout="600" id="selectByCategoryMXCountPage" resultMap="AnbiaoRiskDetailVOResultMap"
            parameterType="org.springblade.anbiao.risk.page.RiskPage">
        <if test="size == 0">
            select * from (
            <include refid="tableTJMXSql"/>
            )b
            where 1=1
            <include refid="queryTJMXSql"/>
            <include refid="orderTJMXSql"/>
            limit ${total}
        </if>
        <if test="current != 0">
            select * from (
            <include refid="tableTJMXSql"/>
            )b
            where 1=1
            <include refid="queryTJMXSql"/>
            <include refid="orderTJMXSql"/>
            limit ${offsetNo},${size}
        </if>
    </select>

    <select timeout="90" id="selectByCategoryMXCountTotal"
            parameterType="org.springblade.anbiao.risk.page.RiskPage"
            resultType="int">
        select COUNT(1) from (
        <include refid="tableTJMXSql"/>
        )d where 1 = 1
        <include refid="queryTJMXSql"/>
    </select>

    <select id="selectSystemRisk" resultType="org.springblade.anbiao.risk.vo.AnbiaoSystemRiskVO">
        SELECT f.id as deptId,a.id as jiaShiYuanId,a.jiashiyuanxingming,
                          ROUND((1-(
                               (
                                     (case when (ifnull(`aja_autograph_time`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`aja_autograph_status`,'') = '') or (`aja_autograph_status` = 0) then 1 else 0 end)
                               )*1.0/2))*100,2) as anquanzerenshu,
                          ROUND((1-(
                               (
                                     (case when (ifnull(`ajr_name`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_sex`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_nation`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_native_place`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_birth`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_age`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_political_outlook`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_education`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_graduation_school`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_graduation_date`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_id_number`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_address`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_receive_driving_license`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_class`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_driving_experience`,'') = '')then 1 else 0 end)
                               )*1.0/ 15))*100,2) as ruzhi,
                          ROUND((1-(
                               (
                                    (case when (ifnull(d.ajw_autograph_time,'') = '') then 1 else 0 end)
                                   +(case when (ifnull(d.ajw_autograph_status,'') = '') or (d.ajw_autograph_status = 0) then 1 else 0 end)
                               )*1.0/2))*100,2) as weihaigaozhishu,
                          ROUND((1-(
                               (
                                     (case when (ifnull(e.ajw_autograph_time,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(e.ajw_autograph_status,'') = '') or (e.ajw_autograph_status = 0) then 1 else 0 end)
                               )*1.0/2))*100,2) as laodonghetong
        FROM
                           anbiao_jiashiyuan a
                 LEFT JOIN anbiao_jiashiyuan_anquanzerenshu b on a.id=b.aja_aj_ids
                 LEFT JOIN anbiao_jiashiyuan_ruzhi c on a.id=c.ajr_aj_ids
                 LEFT JOIN anbiao_jiashiyuan_weihaigaozhishu d on a.id=d.ajw_aj_ids
                 LEFT JOIN anbiao_jiashiyuan_laodonghetong e on a.id=e.ajw_aj_ids
                 LEFT JOIN blade_dept f on a.dept_id=f.id
    </select>

    <select id="ledgerDetail" resultType="org.springblade.anbiao.risk.vo.LedgerDetailVO">
        SELECT *
        FROM  (SELECT ard_dept_ids,ard_content,COUNT(ard_ids) as number
                FROM  anbiao_risk_detail
                where ard_major_categories=2
                GROUP BY ard_dept_ids,ard_content) a
              inner join  (
                <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
              ) bb on a.ard_dept_ids = bb.id
    </select>

    <select id="selectJiashiyuanRiskAll" parameterType="org.springblade.anbiao.risk.page.JiashiyuanRiskAllPage" resultType="org.springblade.anbiao.risk.vo.JiashiyuanRiskAllVO">
        <if test="size == 0" >
        SELECT
        ard_dept_ids as deptId,
        a.dept_name ,
        ard_title ,
        ard_content,
        ard_discovery_date,
        ard_association_value,
        j.jiashiyuanxingming
        FROM
        anbiao_risk_detail rd
        INNER JOIN(
            <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
        ) a on a.id=rd.ard_dept_ids

        INNER JOIN anbiao_organization k on a.id = k.dept_id and k.jigouleixing in('qiye','geti')
        LEFT JOIN  anbiao_jiashiyuan j on j.id=rd.ard_association_value
        WHERE
        ard_is_rectification = 0
        and ard_association_table = "anbiao_jiashiyuan"
        and ard_association_field = "id"
        and j.isdelete=0
        <if test="deptName != null and deptName != ''">
            and a.dept_name like '%${deptName}%'
        </if>
        <if test="jiashiyuanxingming != null and jiashiyuanxingming != ''">
            and j.jiashiyuanxingming like '%${jiashiyuanxingming}%'
        </if>
        ORDER BY j.jiashiyuanxingming
            limit ${total}
        </if>
        <if test="current != 0" >
            SELECT
            ard_dept_ids as deptId,
            a.dept_name ,
            ard_title ,
            ard_content,
            ard_discovery_date,
            ard_association_value,
            j.jiashiyuanxingming
            FROM
            anbiao_risk_detail rd
            INNER JOIN(
            <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
            ) a on a.id=rd.ard_dept_ids

            INNER JOIN anbiao_organization k on a.id = k.dept_id and k.jigouleixing in('qiye','geti')
            LEFT JOIN  anbiao_jiashiyuan j on j.id=rd.ard_association_value
            WHERE
            ard_is_rectification = 0
            and ard_association_table = "anbiao_jiashiyuan"
            and ard_association_field = "id"
            and j.isdelete=0
            <if test="deptName != null and deptName != ''">
                and a.dept_name like '%${deptName}%'
            </if>
            <if test="jiashiyuanxingming != null and jiashiyuanxingming != ''">
                and j.jiashiyuanxingming like '%${jiashiyuanxingming}%'
            </if>
            ORDER BY j.jiashiyuanxingming
            limit ${offsetNo},${size}
        </if>
    </select>


    <select id="selectTotal" parameterType="org.springblade.anbiao.risk.page.JiashiyuanRiskAllPage" resultType="int">
        select COUNT(1) from
        (
        SELECT
        ard_dept_ids as deptId,
        a.dept_name ,
        ard_title ,
        ard_content,
        ard_discovery_date,
        ard_association_value,
        j.jiashiyuanxingming
        FROM
        anbiao_risk_detail rd
        INNER JOIN(
        <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
        ) a on a.id=rd.ard_dept_ids

        INNER JOIN anbiao_organization k on a.id = k.dept_id and k.jigouleixing in('qiye','geti')
        LEFT JOIN  anbiao_jiashiyuan j on j.id=rd.ard_association_value
        WHERE
        ard_is_rectification = 0
        and ard_association_table = "anbiao_jiashiyuan"
        and ard_association_field = "id"
        and j.isdelete=0
        <if test="deptName != null and deptName != ''">
            and a.dept_name like '%${deptName}%'
        </if>
        ORDER BY j.jiashiyuanxingming
        )d
    </select>

    <select id="selectRuZhiRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanRuzhi" parameterType="java.lang.String">
        SELECT
              a.dept_id as deptId
             ,b.dept_name AS deptName
             ,ajr_aj_ids
             ,ajr_name as xingming
             ,(case when IFNULL(ajr_name,'') = '' then 1 else 0 end) as ajr_name
             ,(case when IFNULL(ajr_sex,'') = '' then 1 else 0 end) as ajr_sex
             ,(case when IFNULL(ajr_nation,'') = '' then 1 else 0 end) as ajr_nation
             ,(case when IFNULL(ajr_native_place,'') = '' then 1 else 0 end) as ajr_native_place
             ,(case when IFNULL(ajr_birth,'') = '' then 1 else 0 end) as ajr_birth
             ,(case when IFNULL(ajr_age,'') = '' then 1 else 0 end) as ajr_age
             ,(case when IFNULL(ajr_political_outlook,'') = '' then 1 else 0 end) as ajr_political_outlook
             ,(case when IFNULL(ajr_education,'') = '' then 1 else 0 end) as ajr_education
             ,(case when IFNULL(ajr_graduation_school,'') = '' then 1 else 0 end) as ajr_graduation_school
             ,(case when IFNULL(ajr_graduation_date,'') = '' then 1 else 0 end) as ajr_graduation_date
             ,(case when IFNULL(ajr_id_number,'') = '' then 1 else 0 end) as ajr_id_number
             ,(case when IFNULL(ajr_address,'') = '' then 1 else 0 end) as ajr_address
             ,(case when IFNULL(ajr_receive_driving_license,'') = '' then 1 else 0 end) as ajr_receive_driving_license
             ,(case when IFNULL(ajr_class,'') = '' then 1 else 0 end) as ajr_class
             ,(case when IFNULL(ajr_driving_experience,'') = '' then 1 else 0 end) as ajr_driving_experience
             ,(case when IFNULL(ajr_health_status,'') = '' then 1 else 0 end) as ajr_health_status
             ,(case when IFNULL(ajr_head_portrait,'') = '' then 1 else 0 end) as ajr_head_portrait
             ,(case when IFNULL(ajr_work_experience,'') = '' then 1 else 0 end) as ajr_work_experience
             ,(case when IFNULL(ajr_safe_driving_record1,'') = '' then 1 else 0 end) as ajr_safe_driving_record1
             ,(case when IFNULL(ajr_safe_driving_record2,'') = '' then 1 else 0 end) as ajr_safe_driving_record2
             ,(case when IFNULL(ajr_safe_driving_record3,'') = '' then 1 else 0 end) as ajr_safe_driving_record3

                 FROM anbiao_jiashiyuan_ruzhi
                 left join anbiao_jiashiyuan a on  ajr_aj_ids=a.id
                 inner join (SELECT
                                 DISTINCT
                                 xiaji.id,
                                 xiaji.parent_id,
                                 xiaji.dept_name,
                                 xiaji.is_deleted
                             FROM
                                 blade_dept shangji,
                                 blade_dept xiaji
                             WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                               AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                               and shangji.id=1
        ) b on a.dept_id=b.id
                 INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        where
            ajr_delete=0
        <if test="jiashiyuanId != null and jiashiyuanId != '' ">
            and ajr_aj_ids = #{jiashiyuanId}
        </if>
<!--&#45;&#45; and b.id=5534-->
        ORDER BY a.dept_id
    </select>

    <select id="selectShenFenZhengRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.JiaShiYuan" parameterType="java.lang.String">
        SELECT a.dept_id
             ,a.id
             ,a.jiashiyuanxingming
             ,( CASE WHEN ( ifnull( `shenfenzhenghao`, '' ) = '' ) THEN 1 ELSE 0 END ) as shenfenzhenghao
             , ( CASE WHEN ( ifnull( `shenfenzhengchulingriqi`, '' ) = '' ) THEN 1 ELSE 0 END ) as shenfenzhengchulingriqi
             , ( CASE WHEN ( ifnull( `shenfenzhengyouxiaoqi`, '' ) = '' ) THEN 1 ELSE 0 END ) as shenfenzhengyouxiaoqi
             , ( CASE WHEN ( ifnull( `shenfenzhengfujian`, '' ) = '' ) THEN 1 ELSE 0 END ) as shenfenzhengfujian
             , ( CASE WHEN ( ifnull( `shenfenzhengfanmianfujian`, '' ) = '' ) THEN 1 ELSE 0 END ) as shenfenzhengfanmianfujian
        FROM
            anbiao_jiashiyuan a
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on a.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        WHERE
            a.isdelete=0
        <if test="jiashiyuanId != null and jiashiyuanId != '' ">
            and a.id = #{jiashiyuanId}
        </if>
        ORDER BY
            dept_id
    </select>

    <select id="selectJiaShiZhengRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanJiashizheng" parameterType="java.lang.String">
        SELECT
               b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             , ajj_aj_ids
             , (case when (ifnull(`ajj_file_no`,'') = '') then 1 else 0 end) as ajj_file_no
             , (case when (ifnull(`ajj_valid_period_start`,'') = '') then 1 else 0 end) as ajj_valid_period_start
             , (case when (ifnull(`ajj_valid_period_end`,'') = '') then 1 else 0 end) as ajj_valid_period_end
             , (case when (ifnull(`ajj_front_photo_address`,'') = '') then 1 else 0 end) as ajj_front_photo_address
             , (case when (ifnull(`ajj_attached_photos`,'') = '') then 1 else 0 end) as ajj_attached_photos
        FROM
            anbiao_jiashiyuan_jiashizheng jsz
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=jsz.ajj_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')

        WHERE
            ajj_delete=0
          and jsy.isdelete=0
          <if test="jiashiyuanId != null and jiashiyuanId != '' ">
              and ajj_aj_ids = #{jiashiyuanId}
          </if>
        ORDER BY b.id
    </select>

    <select id="selectCongYeZhengRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanCongyezigezheng" parameterType="java.lang.String">
        SELECT
            b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             ,	ajc_aj_ids
             , (case when (ifnull(`ajc_certificate_no`,'') = '') then 1 else 0 end) as ajc_certificate_no
             , (case when (ifnull(`ajc_initial_issuing`,'') = '') then 1 else 0 end) as ajc_initial_issuing
             , (case when (ifnull(`ajc_valid_until`,'') = '') then 1 else 0 end) as ajc_valid_until
             , (case when (ifnull(`ajc_licence`,'') = '') then 1 else 0 end) as ajc_licence
        FROM
            anbiao_jiashiyuan_congyezigezheng cyz
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=cyz.ajc_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        where
              ajc_delete=0
          and jsy.isdelete=0
        <if test="jiashiyuanId != null and jiashiyuanId != '' ">
            and ajc_aj_ids = #{jiashiyuanId}
        </if>
        ORDER BY b.id
    </select>

    <select id="selectTiJianRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanTijian" parameterType="java.lang.String">
        SELECT
            b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             , ajt_aj_ids
             , (case when (ifnull(`ajt_physical_examination_date`,'') = '') then 1 else 0 end) as ajt_physical_examination_date
             , (case when (ifnull(`ajt_enclosure`,'') = '') then 1 else 0 end) as ajt_enclosure
        FROM
            anbiao_jiashiyuan_tijian tj
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=tj.ajt_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        WHERE
            ajt_delete=0
          and jsy.isdelete=0
          <if test="jiashiyuanId != null and jiashiyuanId != '' ">
              and ajt_aj_ids = #{jiashiyuanId}
          </if>
        ORDER BY b.id
    </select>


    <select id="selectGangQianPeiXunRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanGangqianpeixun" parameterType="java.lang.String">
        SELECT
            b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             , ajg_aj_ids
             , case when (ifnull(`ajg_training_enclosure`,'') = '') then 1 else 0 end as ajg_training_enclosure
        FROM
            anbiao_jiashiyuan_gangqianpeixun gqpx
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=gqpx.ajg_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        WHERE
            ajg_delete=0
          and jsy.isdelete=0
          <if test="jiashiyuanId != null and jiashiyuanId != '' ">
              and ajg_aj_ids = #{jiashiyuanId}
          </if>
        ORDER BY b.id
    </select>

    <select id="selectWuZeZhengMingRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanWuzezhengming" parameterType="java.lang.String">
        SELECT
            b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             , ajw_aj_ids
             , (case when (ifnull(`ajw_date`,'') = '') then 1 else 0 end) as ajw_date
             , (case when (ifnull(`ajw_enclosure`,'') = '') then 1 else 0 end) as ajw_enclosure
        FROM
            anbiao_jiashiyuan_wuzezhengming wzzm
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=wzzm.ajw_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        WHERE
            ajw_delete=0
          and jsy.isdelete=0
        <if test="jiashiyuanId != null and jiashiyuanId != '' ">
            and ajw_aj_ids = #{jiashiyuanId}
        </if>
        ORDER BY b.id
    </select>

    <select id="selectAnQuanZeRenShuRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanAnquanzerenshu" parameterType="java.lang.String">
        SELECT
            b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             , aja_aj_ids
             , (case when (ifnull(`aja_autograph_time`,'') = '') then 1 else 0 end) as aja_autograph_time
             , (case when (ifnull(`aja_autograph_enclosure`,'') = '') then 1 else 0 end) as aja_autograph_enclosure
        FROM
            anbiao_jiashiyuan_anquanzerenshu aqzrs
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=aqzrs.aja_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        WHERE
            aja_delete=0
          and jsy.isdelete=0
        <if test="jiashiyuanId != null and jiashiyuanId != '' ">
            and aja_aj_ids = #{jiashiyuanId}
        </if>
        ORDER BY b.id
    </select>

    <select id="selectWeiHaiGaoZhiShuRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanWeihaigaozhishu" parameterType="java.lang.String">
        SELECT
            b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             , ajw_aj_ids
             ,	(case when (ifnull(`ajw_autograph_time`,'') = '') then 1 else 0 end) as ajw_autograph_time
             , (case when (ifnull(`ajw_autograph_enclosure`,'') = '') then 1 else 0 end) as ajw_autograph_enclosure
        FROM
            anbiao_jiashiyuan_weihaigaozhishu whgzs
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=whgzs.ajw_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        WHERE
            ajw_delete=0
          and jsy.isdelete=0
          <if test="jiashiyuanId != null and jiashiyuanId != '' ">
              and ajw_aj_ids = #{jiashiyuanId}
          </if>
        ORDER BY b.id
    </select>

    <select id="selectLaoDongHeTongRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanLaodonghetong" parameterType="java.lang.String">
        SELECT
            b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             , ajw_aj_ids
             ,	(case when (ifnull(`ajw_autograph_time`,'') = '') then 1 else 0 end) as ajw_autograph_time
             ,  (case when (ifnull(`ajw_autograph_enclosure` ,'') = '') then 1 else 0 end) as ajw_autograph_enclosure
        FROM
            anbiao_jiashiyuan_laodonghetong ldht
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=ldht.ajw_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        WHERE
            ajw_delete=0
          and jsy.isdelete=0
        <if test="jiashiyuanId != null and jiashiyuanId != '' ">
            and ajw_aj_ids = #{jiashiyuanId}
        </if>
        ORDER BY b.id
    </select>

    <select id="selectAnQuanHuiYiRisk"  resultType="org.springblade.anbiao.anquanhuiyi.entity.AnbiaoAnquanhuiyi">
        SELECT
        a.id,
        a.dept_id,
        huiyimingcheng,
        huiyikaishishijian,
        huiyijieshushijian,
        b.aad_ap_name as jiashiyuanxingming,
        c.id as jiashiyuanid,
        SYSDATE()
        FROM
        `anbiao_anquanhuiyi`  a
        LEFT JOIN anbiao_anquanhuiyi_detail b on a.id=b.aad_aa_ids
        LEFT JOIN anbiao_jiashiyuan c on c.jiashiyuanxingming=b.aad_ap_name
        WHERE
        is_deleted = 0
        and b.add_ap_being_joined = 0
        and DATE_FORMAT(huiyijieshushijian, '%Y%m') = DATE_FORMAT(CURDATE(), '%Y%m')
        and c.isdelete=0
        ORDER BY a.id
    </select>

    <select id="selectAnQuanPeiXunRisk"  resultType="org.springblade.anbiao.jiaoyupeixun.entity.AnbiaoSafetyTraining">
        SELECT
            ast_ids,
            ast_dept_ids,
            ast_training_topic,
            ast_training_start_time,
            ast_training_end_time,
            b.aad_ap_name as jiashiyuanxingming,
            c.id as jiashiyuanid,
            SYSDATE()
        FROM
            `anbiao_safety_training`  a
            LEFT JOIN anbiao_safety_training_detail b on a.ast_ids=b.aad_ast_ids
            LEFT JOIN anbiao_jiashiyuan c on c.jiashiyuanxingming=b.aad_ap_name
        WHERE
            ast_delete = 0
            and b.add_ap_being_joined = 0
            and DATE_FORMAT(ast_training_end_time, '%Y%m') = DATE_FORMAT(CURDATE(), '%Y%m')
            and c.isdelete=0
        ORDER BY a.ast_ids
    </select>

    <select id="selectYinHuanPaiChaRisk"  resultType="org.springblade.anbiao.yinhuanpaicha.vo.AnbiaoHiddenDangerVO">
        SELECT
            ahd_ids,
            ahd_dept_ids,
            ahd_describe,
            c.id as jiashiyuanid,
            ahd_driver_name,
            b.cheliangpaizhao
        FROM
            anbiao_hidden_danger  a
                LEFT JOIN anbiao_vehicle b on a.ahd_vehicle_ids=b.id
                LEFT JOIN anbiao_jiashiyuan c on c.jiashiyuanxingming=a.ahd_driver_name
        WHERE
              (ahd_rectification_situation = 0 or ahd_rectification_situation is null)
          and ahd_delete = 0
          and c.isdelete=0
        ORDER BY ahd_dept_ids
    </select>

    <select id="selectWeiXiuDengJiRisk"  resultType="org.springblade.anbiao.cheliangguanli.vo.BaoYangWeiXiuVO">
        SELECT
            a.dept_Id,
            driver_Id,
            b.jiashiyuanxingming,
            vehicle_Id,
            c.cheliangpaizhao,
            acb_maintenance_content,
            acb_repair_reason
        FROM
            anbiao_cheliang_baoyangweixiu a
                LEFT JOIN anbiao_jiashiyuan b on a.driver_Id=b.id
                LEFT JOIN anbiao_vehicle c on a.vehicle_Id=c.id
        WHERE
            a.is_Deleted = 0
          AND (
                acb_after_maintenance = ""
                OR acb_after_maintenance IS NULL
            )
          and b.isdelete=0
          and c.is_deleted=0
        ORDER BY driver_Id
    </select>

    <select id="selectLaBorRisk"  resultType="org.springblade.anbiao.labor.entity.LaborlingquEntity">
        SELECT
            b.ali_dept_ids as deptId,
            b.ali_name,
            a.alr_person_ids,
            a.alr_person_name
        FROM
            `anbiao_labor_receive` a
                LEFT JOIN anbiao_labor_insurance b on b.ali_ids=a.alr_ali_ids
                LEFT JOIN anbiao_jiashiyuan c on c.id=a.alr_person_ids
        WHERE
            alr_delete = 0
          AND (
                alr_receipts_number = ""
                OR alr_receipts_number IS NULL
            )
          and b.ali_delete=0
          and c.isdelete=0
        ORDER BY b.ali_ids
    </select>

    <select id="selectAnQuanJianChaRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoCheliangJiashiyuanDaily">
        SELECT
            b.dept_id,
            a.vehid,
            c.cheliangpaizhao,
            a.jiashiyuanid,
            b.jiashiyuanxingming,
            d.createtime
        FROM
            `anbiao_cheliang_jiashiyuan_daily` a
                LEFT JOIN anbiao_jiashiyuan b ON a.jiashiyuanid = b.id
                LEFT JOIN anbiao_vehicle c ON a.vehid = c.id
                LEFT JOIN ( SELECT jsyid,vehid,MAX(createtime) createtime FROM `anbiao_car_examine_info` GROUP BY jsyid ORDER BY createtime desc ) as d on d.jsyid=a.jiashiyuanid
        WHERE
            a.vstatus = 1
          AND b.isdelete = 0
          AND c.is_deleted = 0
        ORDER BY
            b.dept_id
    </select>

    <select id="selectXingShiZhengRisk"  resultType="org.springblade.anbiao.cheliangguanli.entity.VehicleXingshizheng" parameterType="java.lang.String">
        SELECT
            a.id as vehicleId
             , a.dept_id
             , cheliangpaizhao
             , d.jiashiyuanxingming
             , d.id as jiashiyuanid
             , (case when ((ifnull(`avx_plate_no`,'') = '') ) then 1 else 0 end) as avx_plate_no
             , (case when ((ifnull(`avx_owner`,'') = '') ) then 1 else 0 end) as avx_owner
             , (case when ((ifnull(`avx_use_charter`,'') = '') ) then 1 else 0 end) as avx_use_charter
             , (case when ((ifnull(`avx_model`,'') = '') ) then 1 else 0 end) as avx_model
             , (case when ((ifnull(`avx_vin`,'') = '') ) then 1 else 0 end) as avx_vin
             , (case when ((ifnull(`avx_engine_no`,'') = '') ) then 1 else 0 end) as avx_engine_no
             , (case when ((ifnull(`avx_register_date`,'') = '') ) then 1 else 0 end) as avx_register_date2
             , (case when ((ifnull(`avx_issue_date`,'') = '') ) then 1 else 0 end) as avx_issue_date2
             , (case when ((ifnull(`avx_authorized_seating_capacity`,'') = '') ) then 1 else 0 end) as avx_authorized_seating_capacity
             , (case when ((ifnull(`avx_total_mass`,'') = '') ) then 1 else 0 end) as avx_total_mass
             , (case when ((ifnull(`avx_curb_weight`,'') = '') ) then 1 else 0 end) as avx_curb_weight
             , (case when ((ifnull(`avx_overall_dimensions`,'') = '') ) then 1 else 0 end) as avx_overall_dimensions
             , (case when ((ifnull(`avx_quasi_tractive_mass`,'') = '') ) then 1 else 0 end) as avx_quasi_tractive_mass
             , (case when ((ifnull(`avx_valid_until`,'') = '') ) then 1 else 0 end) as avx_valid_until2
             , (case when ((ifnull(`avx_file_no`,'') = '') ) then 1 else 0 end) as avx_file_no
             , (case when ((ifnull(`avx_original_enclosure`,'') = '') ) then 1 else 0 end) as avx_original_enclosure
             , (case when ((ifnull(`avx_copy_enclosure`,'') = '') ) then 1 else 0 end) as avx_copy_enclosure
        FROM
            anbiao_vehicle a
                INNER JOIN (
                SELECT DISTINCT
                    xiaji.id,
                    xiaji.parent_id,
                    xiaji.dept_name,
                    xiaji.is_deleted
                FROM
                    blade_dept shangji,
                    blade_dept xiaji
                WHERE
                    xiaji.tree_code LIKE CONCAT( shangji.tree_code, '%' )
                  AND xiaji.is_deleted = 0
                  AND xiaji.extend_type = '机构'
                  AND shangji.id = 1
            ) b ON a.dept_id = b.id
                LEFT JOIN anbiao_vehicle_xingshizheng c ON a.id = c.avx_av_ids
                LEFT JOIN anbiao_jiashiyuan d ON a.jiashiyuanid = d.id
        WHERE
            a.is_deleted = 0
        <if test="vehicleId != null and vehicleId != '' ">
            and a.id = #{vehicleId}
        </if>
        ORDER BY
            a.id
    </select>

    <select id="selectDaoLuYunShuZhengRisk"  resultType="org.springblade.anbiao.cheliangguanli.entity.VehicleDaoluyunshuzheng" parameterType="java.lang.String">
        SELECT
               a.id as vehicleId
             , a.dept_id
             , cheliangpaizhao
             , d.jiashiyuanxingming
             , d.id as jiashiyuanid
             , (case when ((ifnull(`avd_road_transport_certificate_no`,'') = '') ) then 1 else 0 end) as avd_road_transport_certificate_no
             , (case when ((ifnull(`avd_issue_date`,'') = '') ) then 1 else 0 end) as avd_issue_date2
             , (case when ((ifnull(`avd_valid_until`,'') = '') ) then 1 else 0 end) as avd_valid_until2
             , (case when ((ifnull(`avd_enclosure`,'') = '') ) then 1 else 0 end) as avd_enclosure
        FROM
            anbiao_vehicle a
                INNER JOIN (
                SELECT DISTINCT
                    xiaji.id,
                    xiaji.parent_id,
                    xiaji.dept_name,
                    xiaji.is_deleted
                FROM
                    blade_dept shangji,
                    blade_dept xiaji
                WHERE
                    xiaji.tree_code LIKE CONCAT( shangji.tree_code, '%' )
                  AND xiaji.is_deleted = 0
                  AND xiaji.extend_type = '机构'
                  AND shangji.id = 1
            ) b ON a.dept_id = b.id
                LEFT JOIN anbiao_vehicle_daoluyunshuzheng c ON a.id = c.avd_av_ids
                LEFT JOIN anbiao_jiashiyuan d ON a.jiashiyuanid = d.id
        WHERE
            a.is_deleted = 0
        <if test="vehicleId != null and vehicleId != '' ">
            and a.id = #{vehicleId}
        </if>
        ORDER BY
            a.id
    </select>

    <select id="selectXingNengBaoGaoRisk"  resultType="org.springblade.anbiao.cheliangguanli.entity.VehicleXingnengbaogao" parameterType="java.lang.String">
        SELECT
               a.id as vehicleId
             , a.dept_id
             , cheliangpaizhao
             , d.jiashiyuanxingming
             , d.id as jiashiyuanid
             , (case when (ifnull(`avx_enclosure`,'') = '') then 1 else 0 end) as avx_enclosure
        FROM
            anbiao_vehicle a
                INNER JOIN (
                SELECT DISTINCT
                    xiaji.id,
                    xiaji.parent_id,
                    xiaji.dept_name,
                    xiaji.is_deleted
                FROM
                    blade_dept shangji,
                    blade_dept xiaji
                WHERE
                    xiaji.tree_code LIKE CONCAT( shangji.tree_code, '%' )
                  AND xiaji.is_deleted = 0
                  AND xiaji.extend_type = '机构'
                  AND shangji.id = 1
            ) b ON a.dept_id = b.id
                LEFT JOIN anbiao_vehicle_xingnengbaogao c ON a.id = c.avx_av_ids
                LEFT JOIN anbiao_jiashiyuan d ON a.jiashiyuanid = d.id
        WHERE
            a.is_deleted = 0
        <if test="vehicleId != null and vehicleId != '' ">
            and a.id = #{vehicleId}
        </if>
        ORDER BY
            a.id
    </select>

    <select id="selectDengJiZhengShuRisk"  resultType="org.springblade.anbiao.cheliangguanli.entity.VehicleDengjizhengshu" parameterType="java.lang.String">
        SELECT
               a.id as vehicleId
             , a.dept_id
             , cheliangpaizhao
             , d.jiashiyuanxingming
             , d.id as jiashiyuanid
             , (case when (ifnull(`avd_enclosure`,'') = '') then 1 else 0 end) as avd_enclosure
        FROM
            anbiao_vehicle a
                INNER JOIN (
                SELECT DISTINCT
                    xiaji.id,
                    xiaji.parent_id,
                    xiaji.dept_name,
                    xiaji.is_deleted
                FROM
                    blade_dept shangji,
                    blade_dept xiaji
                WHERE
                    xiaji.tree_code LIKE CONCAT( shangji.tree_code, '%' )
                  AND xiaji.is_deleted = 0
                  AND xiaji.extend_type = '机构'
                  AND shangji.id = 1
            ) b ON a.dept_id = b.id
                LEFT JOIN anbiao_vehicle_dengjizhengshu c ON a.id = c.avd_vehicle_ids
                LEFT JOIN anbiao_jiashiyuan d ON a.jiashiyuanid = d.id
        WHERE
            a.is_deleted = 0
        <if test="vehicleId != null and vehicleId != '' ">
            and a.id = #{vehicleId}
        </if>
        ORDER BY
            a.id
    </select>

    <select id="selectVehicleRiskAll" parameterType="org.springblade.anbiao.risk.page.VehicleRiskAllPage" resultType="org.springblade.anbiao.risk.vo.VehicleRiskAllVO">
        <if test="size == 0" >
            SELECT
            a.ard_dept_ids as deptId,
            e.dept_name,
            c.jiashiyuanid,
            d.jiashiyuanxingming,
            ard_title ,
            ard_content,
            ard_type,
            ard_discovery_date,
            ard_association_value,
            a.vehicleId,
            a.cheliangpaizhao
            FROM
            `anbiao_risk_detail` a
            LEFT JOIN anbiao_vehicle b on b.id=a.ard_association_value
            LEFT JOIN anbiao_cheliang_jiashiyuan_daily c on (c.vehid=a.ard_association_value or c.gvehid=a.ard_association_value)
            LEFT JOIN anbiao_jiashiyuan d on c.jiashiyuanid=d.id
            INNER JOIN(
            <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
            ) e on e.id=a.ard_dept_ids
            WHERE
            ard_association_table = "anbiao_vehicle"
            and ard_is_rectification=0
            and b.is_deleted=0
            and (c.vstatus=1 or c.gstatus=1)
            and d.isdelete=0
            and e.is_deleted=0
         <if test="jiashiyuanxingming != null and jiashiyuanxingming != ''">
            and d.jiashiyuanxingming like '%${jiashiyuanxingming}%'
         </if>
        <if test="cheliangpaizhao != null and cheliangpaizhao != ''">
            and a.cheliangpaizhao like '%${cheliangpaizhao}%'
        </if>
            <if test="jiashiyuanid != null and jiashiyuanid != ''">
                AND c.jiashiyuanid = #{jiashiyuanid}
            </if>
            <if test="deptName != null and deptName != ''">
                and e.dept_name like '%${deptName}%'
            </if>
            ORDER BY
            ard_association_value
            limit ${total}
        </if>
        <if test="current != 0" >
            SELECT
            a.ard_dept_ids as deptId,
            e.dept_name,
            c.jiashiyuanid,
            d.jiashiyuanxingming,
            ard_title ,
            ard_content,
            ard_type,
            ard_discovery_date,
            ard_association_value,
            a.vehicleId,
            a.cheliangpaizhao
            FROM
            `anbiao_risk_detail` a
            LEFT JOIN anbiao_vehicle b on b.id=a.ard_association_value
            LEFT JOIN anbiao_cheliang_jiashiyuan_daily c on (c.vehid=a.ard_association_value or c.gvehid=a.ard_association_value)
            LEFT JOIN anbiao_jiashiyuan d on c.jiashiyuanid=d.id
            INNER JOIN(
            <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
            ) e on e.id=a.ard_dept_ids
            WHERE
            ard_association_table = "anbiao_vehicle"
            and ard_is_rectification=0
            and b.is_deleted=0
            and (c.vstatus=1 or c.gstatus=1)
            and d.isdelete=0
            and e.is_deleted=0
            <if test="jiashiyuanxingming != null and jiashiyuanxingming != ''">
                and d.jiashiyuanxingming like '%${jiashiyuanxingming}%'
            </if>
            <if test="cheliangpaizhao != null and cheliangpaizhao != ''">
                and a.cheliangpaizhao like '%${cheliangpaizhao}%'
            </if>
            <if test="jiashiyuanid != null and jiashiyuanid != ''">
                AND c.jiashiyuanid = #{jiashiyuanid}
            </if>
            <if test="deptName != null and deptName != ''">
                and e.dept_name like '%${deptName}%'
            </if>
            ORDER BY
            ard_association_value
            limit ${offsetNo},${size}
        </if>
    </select>

    <select id="selectVehicleRiskTotal" parameterType="org.springblade.anbiao.risk.page.VehicleRiskAllPage" resultType="int">
        select COUNT(1) from
        (
        SELECT
        a.ard_dept_ids as deptId,
        e.dept_name,
        c.jiashiyuanid,
        d.jiashiyuanxingming,
        ard_title ,
        ard_content,
        ard_type,
        ard_discovery_date,
        ard_association_value,
        a.vehicleId,
        a.cheliangpaizhao
        FROM
        `anbiao_risk_detail` a
        LEFT JOIN anbiao_vehicle b on b.id=a.ard_association_value
        LEFT JOIN anbiao_cheliang_jiashiyuan_daily c on (c.vehid=a.ard_association_value or c.gvehid=a.ard_association_value)
        LEFT JOIN anbiao_jiashiyuan d on c.jiashiyuanid=d.id
        INNER JOIN(
        <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
        ) e on e.id=a.ard_dept_ids
        WHERE
        ard_association_table = "anbiao_vehicle"
        and ard_is_rectification=0
        and b.is_deleted=0
        and (c.vstatus=1 or c.gstatus=1)
        and d.isdelete=0
        and e.is_deleted=0
        <if test="jiashiyuanxingming != null and jiashiyuanxingming != ''">
            and d.jiashiyuanxingming like '%${jiashiyuanxingming}%'
        </if>
        <if test="cheliangpaizhao != null and cheliangpaizhao != ''">
            and a.cheliangpaizhao like '%${cheliangpaizhao}%'
        </if>
        <if test="jiashiyuanid != null and jiashiyuanid != ''">
            AND c.jiashiyuanid like #{jiashiyuanid}
        </if>
        <if test="deptName != null and deptName != ''">
            and e.dept_name like '%${deptName}%'
        </if>
        ORDER BY
        ard_association_value
        )d
    </select>

    <select id="selectJiaShiYuanBaoXianRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.JiaShiYuan" parameterType="java.lang.String">
        SELECT
            a.id ,
            a.dept_id,
            a.jiashiyuanxingming
        FROM
            anbiao_jiashiyuan a
                LEFT JOIN anbiao_jiashiyuan_baoxian b ON a.id = b.ajb_insured_ids AND b.ajb_delete = 0
        WHERE
            a.isdelete = 0
          AND (b.ajb_insured_ids IS NULL OR b.ajb_insured_ids = '')
        <if test="jiashiyuanId != null and jiashiyuanId != '' ">
            and a.id = #{jiashiyuanId}
        </if>
        ORDER BY
            a.id
    </select>

    <select id="selectVehicleBaoXianRisk"  resultType="org.springblade.anbiao.cheliangguanli.entity.Vehicle" parameterType="java.lang.String">

        SELECT
        id,
        cheliangpaizhao,
        dept_id
        FROM
        anbiao_vehicle j
        LEFT JOIN anbiao_vehicle_baoxian o ON j.id = o.avb_av_ids AND o.avb_delete = 0
        WHERE
        j.is_deleted = 0
        and (avb_av_ids IS NULL OR avb_av_ids = '')
        <if test="vehicleId != null and vehicleId != '' ">
            and id = #{vehicleId}
        </if>

    </select>


</mapper>
