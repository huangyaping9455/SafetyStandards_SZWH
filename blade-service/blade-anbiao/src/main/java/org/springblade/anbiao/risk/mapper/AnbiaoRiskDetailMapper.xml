<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.springblade.anbiao.risk.mapper.AnbiaoRiskDetailMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="org.springblade.anbiao.risk.entity.AnbiaoRiskDetail">
        <id column="ard_ids" property="ardIds" />
        <result column="ard_dept_ids" property="ardDeptIds" />
        <result column="ard_major_categories" property="ardMajorCategories" />
        <result column="ard_sub_category" property="ardSubCategory" />
        <result column="ard_title" property="ardTitle" />
        <result column="ard_content" property="ardContent" />
        <result column="ard_type" property="ardType" />
        <result column="ard_discovery_date" property="ardDiscoveryDate" />
        <result column="ard_is_rectification" property="ardIsRectification" />
        <result column="ard_association_table" property="ardAssociationTable" />
        <result column="ard_association_field" property="ardAssociationField" />
        <result column="ard_association_value" property="ardAssociationValue" />
        <result column="ard_rectification_by_ids" property="ardRectificationByIds" />
        <result column="ard_rectification_by_name" property="ardRectificationByName" />
        <result column="ard_rectification_date" property="ardRectificationDate" />
        <result column="ard_modular_name" property="ardModularName" />
        <result column="ard_rectification_field" property="ardRectificationField" />
        <result column="ard_rectification_value" property="ardRectificationValue" />
        <result column="ard_rectification_field_type" property="ardRectificationFieldType" />
        <result column="ard_rectification_enclosure" property="ardRectificationEnclosure" />
    </resultMap>

    <resultMap id="AnbiaoRiskDetailCountVOResultMap" type="org.springblade.anbiao.risk.vo.AnbiaoRiskDetailCountVO">
        <result column="ard_major_categories" property="ardMajorCategories" />
        <result column="ard_sub_category" property="ardSubCategory" />
        <result column="ard_discovery_date" property="ardDiscoveryDate" />
    </resultMap>

    <resultMap id="AnbiaoRiskDetailVOResultMap" type="org.springblade.anbiao.risk.vo.AnbiaoRiskDetailVO">
        <id column="ard_ids" property="ardIds" />
        <result column="ard_dept_ids" property="ardDeptIds" />
        <result column="ard_major_categories" property="ardMajorCategories" />
        <result column="ard_sub_category" property="ardSubCategory" />
        <result column="ard_title" property="ardTitle" />
        <result column="ard_content" property="ardContent" />
        <result column="ard_discovery_date" property="ardDiscoveryDate" />
        <result column="ard_association_table" property="ardAssociationTable" />
        <result column="ard_association_field" property="ardAssociationField" />
        <result column="ard_association_value" property="ardAssociationValue" />
    </resultMap>

    <resultMap id="JiaShiYuanResultMap" type="org.springblade.anbiao.jiashiyuan.entity.JiaShiYuan">
    </resultMap>

    <resultMap id="OrganizationsResultMap" type="org.springblade.anbiao.guanlijigouherenyuan.entity.Organizations">
    </resultMap>

    <resultMap id="VehicleResultMap" type="org.springblade.anbiao.cheliangguanli.entity.Vehicle">
    </resultMap>

    <select id="selectByCount" resultMap="AnbiaoRiskDetailCountVOResultMap">
        select
            ard_major_categories,
            ard_sub_category,
            count(1) as num
        from
            anbiao_risk_detail a
            inner join (
                <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
            ) b on a.ard_dept_ids = b.id
        where 1 = 1
<!--            ard_dept_ids = #{deptId}-->
            and left(ard_discovery_date,7) = left(#{date},7)
            and ard_is_rectification = 0
        GROUP BY
            ard_major_categories,
            ard_sub_category
    </select>

    <select id="selectByDateCount" resultMap="AnbiaoRiskDetailCountVOResultMap">
        select
            ard_major_categories,
            ard_sub_category,
            ard_discovery_date,
            count(1) as num
        from
            anbiao_risk_detail a
            inner join (
                <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
            ) b on a.ard_dept_ids = b.id
        where 1 = 1
        <!--ard_dept_ids = #{deptId}-->
            and left(ard_discovery_date,7) = left(#{date},7)
            and ard_is_rectification = 0
        GROUP BY
            ard_major_categories,
            ard_sub_category,
            ard_discovery_date
    </select>

    <select id="selectByCategoryCount" resultMap="AnbiaoRiskDetailVOResultMap">
        select
            ard_title,
            ard_type,
            ard_sub_category,
            ard_content,
            count(1) as num
        from
            anbiao_risk_detail a
            inner join (
                <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
            ) b on a.ard_dept_ids = b.id
        where 1 = 1
<!--        ard_dept_ids = #{deptId}-->
            and left(ard_discovery_date,7) = left(#{date},7)
            and ard_sub_category = #{category}
            and ard_is_rectification = 0
        GROUP BY
            ard_title,
            ard_type,
            ard_content
    </select>

    <select id="selectByCategoryMXCount" resultMap="AnbiaoRiskDetailVOResultMap">
        select
            ard_dept_ids,
            ard_ids,
            ard_title,
            ard_type,
            ard_discovery_date,
            ard_content,
            ard_association_value,
            ard_association_table,
            ard_association_field
        from
            anbiao_risk_detail a
            inner join (
                <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
            ) b on a.ard_dept_ids = b.id
        where 1 = 1
<!--            ard_dept_ids = #{deptId}-->
            and left(ard_discovery_date,7) = left(#{date},7)
            and ard_sub_category = #{category}
            and ard_is_rectification = 0
            and ard_content = #{ardContent}
    </select>

    <select id="selectMapList" resultMap="JiaShiYuanResultMap">
        select * from ${ardAssociationTable} where ${ardAssociationField} = #{ardAssociationValue}
    </select>

    <select id="selectOrganizationsMapList" resultMap="OrganizationsResultMap">
        select * from ${ardAssociationTable} where ${ardAssociationField} = #{ardAssociationValue}
    </select>

    <select id="selectVehicleMapList" resultMap="VehicleResultMap">
        select * from ${ardAssociationTable} where ${ardAssociationField} = #{ardAssociationValue}
    </select>

    <sql id="tableTJMXSql">
        select
            ard_dept_ids,
            ard_ids,
            ard_title,
            ard_type,
            ard_discovery_date,
            ard_content,
            ard_association_value,
            ard_association_table,
            ard_association_field
        from
            anbiao_risk_detail a
        inner join (
            <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
        ) b on a.ard_dept_ids = b.id
        where 1 = 1
        <!--            ard_dept_ids = #{deptId}-->
            and left(ard_discovery_date,7) = left(#{date},7)
            and ard_sub_category = #{category}
            and ard_is_rectification = 0
        <if test="ardContent !=null and ardContent != ''">
            and ard_content = #{ardContent}
        </if>
    </sql>
    <sql id="queryTJMXSql">

    </sql>
    <sql id="orderTJMXSql">
        <!-- 默认排序规则 -->
        <if test="orderColumn == null or orderColumn == ''">
            order by ard_ids desc
        </if>
        <if test="orderColumn != null and orderColumn != ''">
            order by ${orderColumn}
        </if>
        <if test="orderColumn != null and orderColumn != '' and order != 0">
            desc
        </if>
    </sql>

    <select timeout="600" id="selectByCategoryMXCountPage" resultMap="AnbiaoRiskDetailVOResultMap"
            parameterType="org.springblade.anbiao.risk.page.RiskPage">
        <if test="size == 0">
            select * from (
            <include refid="tableTJMXSql"/>
            )b
            where 1=1
            <include refid="queryTJMXSql"/>
            <include refid="orderTJMXSql"/>
            limit ${total}
        </if>
        <if test="current != 0">
            select * from (
            <include refid="tableTJMXSql"/>
            )b
            where 1=1
            <include refid="queryTJMXSql"/>
            <include refid="orderTJMXSql"/>
            limit ${offsetNo},${size}
        </if>
    </select>

    <select timeout="90" id="selectByCategoryMXCountTotal"
            parameterType="org.springblade.anbiao.risk.page.RiskPage"
            resultType="int">
        select COUNT(1) from (
        <include refid="tableTJMXSql"/>
        )d where 1 = 1
        <include refid="queryTJMXSql"/>
    </select>

    <select id="selectSystemRisk" resultType="org.springblade.anbiao.risk.vo.AnbiaoSystemRiskVO">
        SELECT f.id as deptId,a.id as jiaShiYuanId,a.jiashiyuanxingming,
                          ROUND((1-(
                               (
                                     (case when (ifnull(`aja_autograph_time`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`aja_autograph_status`,'') = '') or (`aja_autograph_status` = 0) then 1 else 0 end)
                               )*1.0/2))*100,2) as anquanzerenshu,
                          ROUND((1-(
                               (
                                     (case when (ifnull(`ajr_name`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_sex`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_nation`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_native_place`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_birth`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_age`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_political_outlook`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_education`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_graduation_school`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_graduation_date`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_id_number`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_address`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_receive_driving_license`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_class`,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(`ajr_driving_experience`,'') = '')then 1 else 0 end)
                               )*1.0/ 15))*100,2) as ruzhi,
                          ROUND((1-(
                               (
                                    (case when (ifnull(d.ajw_autograph_time,'') = '') then 1 else 0 end)
                                   +(case when (ifnull(d.ajw_autograph_status,'') = '') or (d.ajw_autograph_status = 0) then 1 else 0 end)
                               )*1.0/2))*100,2) as weihaigaozhishu,
                          ROUND((1-(
                               (
                                     (case when (ifnull(e.ajw_autograph_time,'') = '') then 1 else 0 end)
                                   + (case when (ifnull(e.ajw_autograph_status,'') = '') or (e.ajw_autograph_status = 0) then 1 else 0 end)
                               )*1.0/2))*100,2) as laodonghetong
        FROM
                           anbiao_jiashiyuan a
                 LEFT JOIN anbiao_jiashiyuan_anquanzerenshu b on a.id=b.aja_aj_ids
                 LEFT JOIN anbiao_jiashiyuan_ruzhi c on a.id=c.ajr_aj_ids
                 LEFT JOIN anbiao_jiashiyuan_weihaigaozhishu d on a.id=d.ajw_aj_ids
                 LEFT JOIN anbiao_jiashiyuan_laodonghetong e on a.id=e.ajw_aj_ids
                 LEFT JOIN blade_dept f on a.dept_id=f.id
    </select>

    <select id="ledgerDetail" resultType="org.springblade.anbiao.risk.vo.LedgerDetailVO">
        SELECT *
        FROM  (SELECT ard_dept_ids,ard_content,COUNT(ard_ids) as number
                FROM  anbiao_risk_detail
                where ard_major_categories=2
                GROUP BY ard_dept_ids,ard_content) a
              inner join  (
                <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
              ) bb on a.ard_dept_ids = bb.id
    </select>

    <select id="selectJiashiyuanRiskAll" parameterType="org.springblade.anbiao.risk.page.JiashiyuanRiskAllPage" resultType="org.springblade.anbiao.risk.vo.JiashiyuanRiskAllVO">
        <if test="size == 0" >
        SELECT
        ard_dept_ids as deptId,
        a.dept_name ,
        ard_title ,
        ard_content,
        ard_discovery_date,
        ard_association_value,
        j.jiashiyuanxingming
        FROM
        anbiao_risk_detail rd
        INNER JOIN(
            <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
        ) a on a.id=rd.ard_dept_ids

        INNER JOIN anbiao_organization k on a.id = k.dept_id and k.jigouleixing in('qiye','geti')
        LEFT JOIN  anbiao_jiashiyuan j on j.id=rd.ard_association_value
        WHERE
        ard_is_rectification = 0
        and ard_association_table = "anbiao_jiashiyuan"
        and ard_association_field = "id"
        and j.isdelete=0
        <if test="deptName != null or deptName != ''">
            and a.dept_name like '%${deptName}%'
        </if>
        <if test="jiashiyuanxingming != null or jiashiyuanxingming != ''">
            and j.jiashiyuanxingming like '%${jiashiyuanxingming}%'
        </if>
        ORDER BY j.jiashiyuanxingming
            limit ${total}
        </if>
        <if test="current != 0" >
            SELECT
            ard_dept_ids as deptId,
            a.dept_name ,
            ard_title ,
            ard_content,
            ard_discovery_date,
            ard_association_value,
            j.jiashiyuanxingming
            FROM
            anbiao_risk_detail rd
            INNER JOIN(
            <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
            ) a on a.id=rd.ard_dept_ids

            INNER JOIN anbiao_organization k on a.id = k.dept_id and k.jigouleixing in('qiye','geti')
            LEFT JOIN  anbiao_jiashiyuan j on j.id=rd.ard_association_value
            WHERE
            ard_is_rectification = 0
            and ard_association_table = "anbiao_jiashiyuan"
            and ard_association_field = "id"
            and j.isdelete=0
            <if test="deptName != null or deptName != ''">
                and a.dept_name like '%${deptName}%'
            </if>
            <if test="jiashiyuanxingming != null or jiashiyuanxingming != ''">
                and j.jiashiyuanxingming like '%${jiashiyuanxingming}%'
            </if>
            ORDER BY j.jiashiyuanxingming
            limit ${offsetNo},${size}
        </if>
    </select>


    <select id="selectTotal" parameterType="org.springblade.anbiao.risk.page.JiashiyuanRiskAllPage" resultType="int">
        select COUNT(1) from
        (
        SELECT
        ard_dept_ids as deptId,
        a.dept_name ,
        ard_title ,
        ard_content,
        ard_discovery_date,
        ard_association_value,
        j.jiashiyuanxingming
        FROM
        anbiao_risk_detail rd
        INNER JOIN(
        <include refid="org.springblade.anbiao.guanlijigouherenyuan.mapper.OrganizationsMapper.getByDeptId"/>
        ) a on a.id=rd.ard_dept_ids

        INNER JOIN anbiao_organization k on a.id = k.dept_id and k.jigouleixing in('qiye','geti')
        LEFT JOIN  anbiao_jiashiyuan j on j.id=rd.ard_association_value
        WHERE
        ard_is_rectification = 0
        and ard_association_table = "anbiao_jiashiyuan"
        and ard_association_field = "id"
        and j.isdelete=0
        <if test="deptName != null or deptName != ''">
            and a.dept_name like '%${deptName}%'
        </if>
        ORDER BY j.jiashiyuanxingming
        )d
    </select>

    <select id="selectRuZhiRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanRuzhi">
        SELECT
            a.dept_id as deptId
             ,b.dept_name AS deptName
             ,ajr_aj_ids
             ,ajr_name as xingming
             ,(case when IFNULL(ajr_name,'') = '' then 1 else 0 end) as ajr_name
             ,(case when IFNULL(ajr_sex,'') = '' then 1 else 0 end) as ajr_sex
             ,(case when IFNULL(ajr_nation,'') = '' then 1 else 0 end) as ajr_nation
             ,(case when IFNULL(ajr_native_place,'') = '' then 1 else 0 end) as ajr_native_place
             ,(case when IFNULL(ajr_birth,'') = '' then 1 else 0 end) as ajr_birth
             ,(case when IFNULL(ajr_age,'') = '' then 1 else 0 end) as ajr_age
             ,(case when IFNULL(ajr_political_outlook,'') = '' then 1 else 0 end) as ajr_political_outlook
             ,(case when IFNULL(ajr_education,'') = '' then 1 else 0 end) as ajr_education
             ,(case when IFNULL(ajr_graduation_school,'') = '' then 1 else 0 end) as ajr_graduation_school
             ,(case when IFNULL(ajr_graduation_date,'') = '' then 1 else 0 end) as ajr_graduation_date
             ,(case when IFNULL(ajr_id_number,'') = '' then 1 else 0 end) as ajr_id_number
             ,(case when IFNULL(ajr_address,'') = '' then 1 else 0 end) as ajr_address
             ,(case when IFNULL(ajr_receive_driving_license,'') = '' then 1 else 0 end) as ajr_receive_driving_license
             ,(case when IFNULL(ajr_class,'') = '' then 1 else 0 end) as ajr_class
             ,(case when IFNULL(ajr_driving_experience,'') = '' then 1 else 0 end) as ajr_driving_experience
             ,(case when IFNULL(ajr_health_status,'') = '' then 1 else 0 end) as ajr_health_status
             ,(case when IFNULL(ajr_head_portrait,'') = '' then 1 else 0 end) as ajr_head_portrait
             ,(case when IFNULL(ajr_work_experience,'') = '' then 1 else 0 end) as ajr_work_experience
             ,(case when IFNULL(ajr_safe_driving_record1,'') = '' then 1 else 0 end) as ajr_safe_driving_record1
             ,(case when IFNULL(ajr_safe_driving_record2,'') = '' then 1 else 0 end) as ajr_safe_driving_record2
             ,(case when IFNULL(ajr_safe_driving_record3,'') = '' then 1 else 0 end) as ajr_safe_driving_record3
             ,(case when IFNULL(ajr_integrity_assessment_results,'') = '' then 1 else 0 end) as ajr_integrity_assessment_results

                 FROM anbiao_jiashiyuan_ruzhi
                 left join anbiao_jiashiyuan a on  ajr_aj_ids=a.id
                 inner join (SELECT
                                 DISTINCT
                                 xiaji.id,
                                 xiaji.parent_id,
                                 xiaji.dept_name,
                                 xiaji.is_deleted
                             FROM
                                 blade_dept shangji,
                                 blade_dept xiaji
                             WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                               AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                               and shangji.id=1
        ) b on a.dept_id=b.id
                 INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        where
            ajr_delete=0
-- and b.id=5534
        ORDER BY a.dept_id
    </select>

    <select id="selectShenFenZhengRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.JiaShiYuan">
        SELECT a.dept_id
             ,a.id
             ,a.jiashiyuanxingming
             ,( CASE WHEN ( ifnull( `shenfenzhenghao`, '' ) = '' ) THEN 1 ELSE 0 END ) as shenfenzhenghao
             , ( CASE WHEN ( ifnull( `shenfenzhengchulingriqi`, '' ) = '' ) THEN 1 ELSE 0 END ) as shenfenzhengchulingriqi
             , ( CASE WHEN ( ifnull( `shenfenzhengyouxiaoqi`, '' ) = '' ) THEN 1 ELSE 0 END ) as shenfenzhengyouxiaoqi
             , ( CASE WHEN ( ifnull( `shenfenzhengfujian`, '' ) = '' ) THEN 1 ELSE 0 END ) as shenfenzhengfujian
             , ( CASE WHEN ( ifnull( `shenfenzhengfanmianfujian`, '' ) = '' ) THEN 1 ELSE 0 END ) as shenfenzhengfanmianfujian
        FROM
            anbiao_jiashiyuan a
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on a.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        WHERE
            a.isdelete=0
        ORDER BY
            dept_id
    </select>

    <select id="selectJiaShiZhengRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanJiashizheng">
        SELECT
               b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             , ajj_aj_ids
             , (case when (ifnull(`ajj_file_no`,'') = '') then 1 else 0 end) as ajj_file_no
             , (case when (ifnull(`ajj_valid_period_start`,'') = '') then 1 else 0 end) as ajj_valid_period_start
             , (case when (ifnull(`ajj_valid_period_end`,'') = '') then 1 else 0 end) as ajj_valid_period_end
             , (case when (ifnull(`ajj_front_photo_address`,'') = '') then 1 else 0 end) as ajj_front_photo_address
             , (case when (ifnull(`ajj_attached_photos`,'') = '') then 1 else 0 end) as ajj_attached_photos
        FROM
            anbiao_jiashiyuan_jiashizheng jsz
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=jsz.ajj_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')

        WHERE
            ajj_delete=0
          and jsy.isdelete=0
        ORDER BY b.id
    </select>

    <select id="selectCongYeZhengRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanCongyezigezheng">
        SELECT
            b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             ,	ajc_aj_ids
             , (case when (ifnull(`ajc_certificate_no`,'') = '') then 1 else 0 end) as ajc_certificate_no
             , (case when (ifnull(`ajc_initial_issuing`,'') = '') then 1 else 0 end) as ajc_initial_issuing
             , (case when (ifnull(`ajc_valid_until`,'') = '') then 1 else 0 end) as ajc_valid_until
             , (case when (ifnull(`ajc_licence`,'') = '') then 1 else 0 end) as ajc_licence
        FROM
            anbiao_jiashiyuan_congyezigezheng cyz
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=cyz.ajc_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        where
              ajc_delete=0
          and jsy.isdelete=0
        ORDER BY b.id
    </select>

    <select id="selectTiJianRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanTijian">
        SELECT
            b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             , ajt_aj_ids
             , (case when (ifnull(`ajt_physical_examination_date`,'') = '') then 1 else 0 end) as ajt_physical_examination_date
             , (case when (ifnull(`ajt_enclosure`,'') = '') then 1 else 0 end) as ajt_enclosure
        FROM
            anbiao_jiashiyuan_tijian tj
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=tj.ajt_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        WHERE
            ajt_delete=0
          and jsy.isdelete=0
        ORDER BY b.id
    </select>


    <select id="selectGangQianPeiXunRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanGangqianpeixun">
        SELECT
            b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             , ajg_aj_ids
             , case when (ifnull(`ajg_training_enclosure`,'') = '') then 1 else 0 end as ajg_training_enclosure
        FROM
            anbiao_jiashiyuan_gangqianpeixun gqpx
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=gqpx.ajg_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        WHERE
            ajg_delete=0
          and jsy.isdelete=0
        ORDER BY b.id
    </select>

    <select id="selectWuZeZhengMingRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanWuzezhengming">
        SELECT
            b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             , ajw_aj_ids
             , (case when (ifnull(`ajw_date`,'') = '') then 1 else 0 end) as ajw_date
             , (case when (ifnull(`ajw_enclosure`,'') = '') then 1 else 0 end) as ajw_enclosure
        FROM
            anbiao_jiashiyuan_wuzezhengming wzzm
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=wzzm.ajw_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        WHERE
            ajw_delete=0
          and jsy.isdelete=0
        ORDER BY b.id
    </select>

    <select id="selectAnQuanZeRenShuRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanAnquanzerenshu">
        SELECT
            b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             , aja_aj_ids
             , (case when (ifnull(`aja_autograph_time`,'') = '') then 1 else 0 end) as aja_autograph_time
             , (case when (ifnull(`aja_autograph_enclosure`,'') = '') then 1 else 0 end) as aja_autograph_enclosure
        FROM
            anbiao_jiashiyuan_anquanzerenshu aqzrs
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=aqzrs.aja_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        WHERE
            aja_delete=0
          and jsy.isdelete=0
        ORDER BY b.id
    </select>

    <select id="selectWeiHaiGaoZhiShuRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanWeihaigaozhishu">
        SELECT
            b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             , ajw_aj_ids
             ,	(case when (ifnull(`ajw_autograph_time`,'') = '') then 1 else 0 end) as ajw_autograph_time
             , (case when (ifnull(`ajw_autograph_enclosure`,'') = '') then 1 else 0 end) as ajw_autograph_enclosure
        FROM
            anbiao_jiashiyuan_weihaigaozhishu whgzs
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=whgzs.ajw_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        WHERE
            ajw_delete=0
          and jsy.isdelete=0
        ORDER BY b.id
    </select>

    <select id="selectLaoDongHeTongRisk"  resultType="org.springblade.anbiao.jiashiyuan.entity.AnbiaoJiashiyuanLaodonghetong">
        SELECT
            b.id as deptId
             , jsy.jiashiyuanxingming as jiashiyuanxingming
             , ajw_aj_ids
             ,	(case when (ifnull(`ajw_autograph_time`,'') = '') then 1 else 0 end) as ajw_autograph_time
             ,  (case when (ifnull(`ajw_autograph_enclosure` ,'') = '') then 1 else 0 end) as ajw_autograph_enclosure
        FROM
            anbiao_jiashiyuan_laodonghetong ldht
                LEFT JOIN anbiao_jiashiyuan jsy on jsy.id=ldht.ajw_aj_ids
                inner join (SELECT
                                DISTINCT
                                xiaji.id,
                                xiaji.parent_id,
                                xiaji.dept_name,
                                xiaji.is_deleted
                            FROM
                                blade_dept shangji,
                                blade_dept xiaji
                            WHERE xiaji.tree_code LIKE CONCAT(shangji.tree_code,'%')
                              AND xiaji.is_deleted = 0 AND xiaji.extend_type='机构'
                              and shangji.id=1
            ) b on jsy.dept_id=b.id
                INNER JOIN anbiao_organization k on b.id = k.dept_id and k.jigouleixing in('qiye','geti')
        WHERE
            ajw_delete=0
          and jsy.isdelete=0
        ORDER BY b.id
    </select>

</mapper>
